# 证书管理模块源代码

本目录包含证书管理模块的核心实现代码，提供 X.509 证书的生成、管理和验证功能。

## 文件结构

- `lib.rs`: 模块入口点，定义公共 API 和类型
- `x509.rs`: X.509 证书操作的具体实现

## 详细说明

### lib.rs

模块的主入口文件，定义了以下内容：

- 公共 API 和类型导出
- 错误类型定义
- 模块级文档

这个文件保持简洁，主要功能实现都在 `x509.rs` 中。

### x509.rs

X.509 证书操作的核心实现，包含以下功能：

1. **证书生成**
   - 生成自签名 X.509 证书
   - 支持 RSA 和 ECC 密钥类型
   - 配置证书属性（有效期、主题、扩展等）

2. **证书解析**
   - 解析 PEM 和 DER 格式的证书
   - 提取证书信息（主题、颁发者、有效期等）

3. **证书验证**
   - 验证证书签名
   - 检查证书有效期
   - 验证证书链

4. **密钥管理**
   - 生成密钥对
   - 加载和保存密钥
   - 密钥格式转换

5. **TLS 配置**
   - 为 Rustls 提供 TLS 配置
   - 客户端和服务器证书设置

## 设计模式

1. **工厂模式**
   - 用于创建证书和密钥对象
   - 例如 `generate_self_signed_cert` 函数

2. **构建器模式**
   - 用于配置证书参数
   - 允许链式调用设置不同属性

3. **适配器模式**
   - 在不同证书格式之间转换
   - 例如 PEM 和 DER 格式转换

## 使用示例

```rust
// 生成自签名证书
let (private_key, certificate) = generate_self_signed_cert(
    Some("example.com"),
    &[],
    None,
    None,
)?;

// 将证书和密钥保存为 PEM 格式
write_pem_key_cert(&private_key, &certificate, key_path, cert_path)?;

// 从 PEM 文件加载证书和密钥
let (private_key, certificate) = load_pem_key_cert_to_der(key_path, cert_path)?;
```

## 错误处理

模块使用自定义错误类型处理各种错误情况：

- 证书解析错误
- 密钥生成错误
- 文件 I/O 错误
- 格式转换错误

所有公共函数都返回 `Result` 类型，便于错误传播和处理。

## 依赖关系

主要依赖以下外部库：

- `rcgen`: 用于证书生成
- `rustls`: 提供 TLS 功能
- `x509-parser`: 解析 X.509 证书
- `pem`: 处理 PEM 格式

## 未来改进

1. 支持证书吊销列表 (CRL)
2. 实现在线证书状态协议 (OCSP)
3. 添加证书透明度 (CT) 支持
4. 优化证书链验证性能
